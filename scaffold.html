<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <section id="Delay Calculator">
        <!--flow is gonna be complicated with nested flex and grid elements.-->
        <div class="flex spacebetween">
            <!--2 cols-->
            <div class="flex spacebetween">
                <!--Widget: Job Selector
                    - Main Jobs
                        - MNK
                            - Martial Arts VII (-200 base delay)
                        - NIN (DW)
                        - PUP
                            - Martial Arts IV (-140 base delay)
                            - Opt. Kenkonken (-55 base delay (MA))
                        - Other H2H
                        - SAM
                            - Hasso
                            - 30 base STP + (merits * 2)
                        - DNC
                            - Haste Samba (50/1024 JA haste)
                        - BLU
                            - Source lacks space for DW spell effects, add?
                        - THF
                        - DRK
                            - Last Resort (150/1024 JA haste + merits up to 256 (cap))
                        - Ranged
                    - Sub Jobs
                        - NIN (DW)
                        - MNK
                        - PUP
                        - SAM
                        - DNC
                -->
                <!--these will be whipped out into a component and packed into an object.-->
                <select name="mainjob" id="mainjob">
                    <option value="naj">Unlisted Job</option>
                    <option value="mnk">Monk</option>
                    <option value="nin">Ninja - Dual Wield</option>
                    <option value="pup">Puppetmaster</option>
                    <option value="h2h">Other Hand-To-Hand</option>
                    <option value="sam">Samurai</option>
                    <option value="dnc">Dancer</option>
                    <option value="blu">Blue Mage</option>
                    <option value="thf">Thief</option>
                    <option value="drk">Dark Knight</option>
                    <option value="rat">Ranged Attack</option>
                </select>
                /
                <select name="subjob" id="subjob">
                    <option value="naj">Unlisted Job</option>
                    <option value="nin">Ninja</option>
                    <option value="mnk">Monk</option>
                    <option value="pup">Puppetmaster</option>
                    <option value="sam">Samurai</option>
                    <option value="dnc">Dancer</option>
                </select>
                <!--Widget: Base Delay-->
                <label for="base_delay"></label>
                <input type="number" name="base_delay_mh" id="base_delay_mh" min="1" max="999">
                <!--This second input will be disabled unless main is DNC/NIN/THF or Sub is DNC/NIN, or if BLU
                    has the correct spells slotted to get access to dualwield.-->
                <input type="number" name="base_delay_oh" id="base_delay_oh" min="1" max="999" disabled>
            </div>
            <div>
                <!--Widget: Total Delay
                    To the reader: be aware that many of the numbers used in these calculations may seem stupid
                    It is important that they be exactly as specified, as final values will be incorrect if they are rounded or "fixed".

                    The delay calculation uses a factor of divisor/1024. 
                    - The maximum amount of haste you can get from gear is 256/1024
                        - 1% of haste on the tooltip is equal to precisely 10/1024 haste
                            - This means you need approx. 26% Equipment haste per tooltip to get full delay reduction.
                    - The maximum amount of magical haste you can get is 448/1024
                    - The maximum amount of Job Ability Haste you can get is 256/1024
                    
                    Calculation:
                        Time per swing (in seconds) = Base Delay รท 60 (This isn't precisely correct, but it's more useful this way.)
                        This value is then reduced by your total haste modifier, to a max of 80%. This means that if you have 
                            A lot of Dual Wield, Martial Arts, or are using certain pieces of direct delay-reducing gear,
                            You can have entire segments of your haste/delay reduction that do nothing to actually make you attack faster.
                        For the first run, Martial Arts won't be calculated since it's complicated, it will be implemented later in the project.
                -->
                <span id="totaldelay">0.0</span> (<span id="delaySeconds">0</span> seconds) (<span id="overcapFeedback"></span>)
                <!--Widget: TP per hit
                    This value will require the modified delay from the total delay section.
                        this includes weapon base delay, dual wield, martial arts, and delay reduction -% equipment
                    Dual wield delay for this calculion is as follows:
                        (Weapon 1 Delay + Weapon 2 Delay)(1-Dual Wield %)
                        -------------------------------------------------
                                                2
                    After this value is determined, Base TP per hit is calculated with the following formulae depending on delay.
                    - <= 180
                             (Delay - 180) * 63
                        61 + ------------------
                                    360
                    - 181 - 540
                             (Delay - 180) * 88
                        61 + ------------------
                                    360
                    - 541 - 630
                              (Delay - 540) * 20
                        149 + ------------------
                                     360
                    - 631 - 720
                              (Delay - 630) * 28
                        154 + ------------------
                                     360
                    - 721 - 900
                              (Delay - 720) * 24
                        161 + ------------------
                                     360                    
                    - > 901
                              (Delay - 900) * 28
                        173 + ------------------
                                     360

                    IMPORTANT: These values are all *floor()ed* before being passed to *any* other calculations.
                    These formulae may seem random, but they were given to the players of the game by the development team.
                    
                    This calculation should be fast enough. If it's not, it can be rewritten in C and compiled to wasm for 
                        faster execution.
                    
                    After this step, we apply the bonus from Store TP. Formula:
                    floor(base_tp) + floor(base_tp * (store_tp/100))
                -->
            </div>
        </div>
        <div class="flex grow">
            <p>Equipment Haste</p>
            <div id="equipmenthaste" class="equipmentGrid">
                
                <input type="number" id="eh_0" min="0" max="16">
                <input type="number" id="eh_1" min="0" max="16">
                <input type="number" id="eh_2" min="0" max="16">
                <input type="number" id="eh_3" min="0" max="16">
                <input type="number" id="eh_4" min="0" max="16">
                <input type="number" id="eh_5" min="0" max="16">
                <input type="number" id="eh_6" min="0" max="16">
                <input type="number" id="eh_7" min="0" max="16">
                <input type="number" id="eh_8" min="0" max="16">
                <input type="number" id="eh_9" min="0" max="16">
                <input type="number" id="eh_10" min="0" max="16">
                <input type="number" id="eh_11" min="0" max="16">
                <input type="number" id="eh_12" min="0" max="16">
                <input type="number" id="eh_13" min="0" max="16">
                <input type="number" id="eh_14" min="0" max="16">
                <input type="number" id="eh_15" min="0" max="16">
                <script type="text/javascript">
                    totalHaste = 0
                    for(i=0; i<16; i++) {
                        totalHaste += Number(document.getElementById('eh_'+i).value)
                    }
                </script>
            </div>
            <p>Store TP:</p>
            <div id="storetp" class="equipmentGrid">
                
                <input type="number" id="stp_0" min="0" max="16">
                <input type="number" id="stp_1" min="0" max="16">
                <input type="number" id="stp_2" min="0" max="16">
                <input type="number" id="stp_3" min="0" max="16">
                <input type="number" id="stp_4" min="0" max="16">
                <input type="number" id="stp_5" min="0" max="16">
                <input type="number" id="stp_6" min="0" max="16">
                <input type="number" id="stp_7" min="0" max="16">
                <input type="number" id="stp_8" min="0" max="16">
                <input type="number" id="stp_9" min="0" max="16">
                <input type="number" id="stp_10" min="0" max="16">
                <input type="number" id="stp_11" min="0" max="16">
                <input type="number" id="stp_12" min="0" max="16">
                <input type="number" id="stp_13" min="0" max="16">
                <input type="number" id="stp_14" min="0" max="16">
                <input type="number" id="stp_15" min="0" max="16">
                <script type="text/javascript">
                    totalSTP = 0
                    for(i=0;i<16;i++) {
                        totalSTP += Number(document.getElementById('stp_'+i).value)
                    }
                </script>    
            </div>
            <div id="wstp">

            </div>
        </div>
    </section>
</body>
</html>